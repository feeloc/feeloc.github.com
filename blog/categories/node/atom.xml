<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[["Octopress", "javascript", "Android", "GitHub", "Helloworld", "jamendo", "music", "mootools", "java", "maven", "project", "chrome", "随笔", "面试", "环境搭建", "封装", "算法"]node | feeloc's 杂货铺]]></title>
  <link href="http://www.feeloc.cn/blog/categories/node/atom.xml" rel="self"/>
  <link href="http://www.feeloc.cn/"/>
  <updated>2013-12-19T14:42:04+08:00</updated>
  <id>http://www.feeloc.cn/</id>
  <author>
    <name><![CDATA[feeloc]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[服务器配置，tengine，git，nodejs，grunt，mongodb……]]></title>
    <link href="http://www.feeloc.cn/blog/2013/09/04/server-config/"/>
    <updated>2013-09-04T21:58:00+08:00</updated>
    <id>http://www.feeloc.cn/blog/2013/09/04/server-config</id>
    <content type="html"><![CDATA[<blockquote><p>最近准备用nodejs+mongodb开发个网站，手上正好有个vps，装个centos，那就从头搭建个开发及生产环境吧，目前只需要考虑3点：
1、使用git作代码管理，push后能自动部署到前端资源中。
2、如果修改了node文件，需要push后能查看，在commit消息中加入<code>deploy</code>，代码全站部署。
3、前端资源在发布时压缩，为了更加灵活，在访问时合并，并不是发布时合并。</p></blockquote>

<!-- more -->


<h2>一、tengine安装</h2>

<blockquote><p>采用tengine完全是看中一些好用的模块，像<code>http_concat_module</code>之类的，不乏一些nginx商业版中的功能，taobao好样的。</p></blockquote>

<ul>
<li>先安装centos的编译环境，一阵y，y，y后安装成功
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install gcc gcc-c++ gcc-g77 flex bison autoconf automake bzip2-devel zlib-devel ncurses-devel libjpeg-devel libpng-devel libtiff-devel freetype-devel pam-devel openssl-devel libxml2-devel gettext-devel pcre-devel make</span></code></pre></td></tr></table></div></figure></notextile></div></li>
<li><p>常用工具 全部安装，省得麻烦
<img src="http://feeloc.cn/downloads/images/2013-09-04/1.jpg" width="800" title="'安装成功'" ></p></li>
<li><p>安装pcre，因为tengine依赖pcre</p>

<ul>
<li><code>yum install pcre</code>发现已经安装但版本比较老，反正编译tengine时候需要pcre源代码，更新最新版本
<img src="http://feeloc.cn/downloads/images/2013-09-04/2.png" width="800"></li>
<li><code>yum remove pcre</code>发现有依赖无法删除
<img src="http://feeloc.cn/downloads/images/2013-09-04/3.png" width="800"></li>
<li>直接用<code>rpm -e --nodeps --allmatches pcre</code>，可安全卸载，<code>rpm -ql pcre | cat -n</code>查看下包情况，其实不用卸载
<img src="http://feeloc.cn/downloads/images/2013-09-04/4.png" width="800"></li>
<li>下载pcre源码包放入<code>/usr/localhost/src</code>中，好习惯
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>pcre </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/local/src
</span><span class='line'>wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.33.tar.gz
</span><span class='line'>tar  zxvf pcre-8.33.tar.gz
</span><span class='line'>mkdir /usr/local/pcre  #创建安装目录
</span><span class='line'>cd pcre-8.33
</span><span class='line'>./configure  --prefix=/usr/local/pcre  #配置
</span><span class='line'>make
</span><span class='line'>make install</span></code></pre></td></tr></table></div></figure></notextile></div></li>
</ul>
</li>
<li><p>正式安装tengine服务器
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>tengine </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/local/src
</span><span class='line'>wget http://www.openssl.org/source/openssl-1.0.1e.tar.gz    #因为安装tengin需要openssl源码
</span><span class='line'>cd /usr/local/src
</span><span class='line'>tar  zxvf openssl-1.0.1e.tar.gz
</span><span class='line'>wget http://tengine.taobao.org/download/tengine-1.5.1.tar.gz
</span><span class='line'>tar  zxvf tengine-1.5.1
</span><span class='line'>cd tengine-1.5.1.tar.gz
</span><span class='line'>./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_concat_module --with-openssl=/usr/local/src/openssl-1.0.1e --with-pcre=/usr/local/src/pcre-8.33  #配置&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>--with-pcre=/usr/local/src/pcre-8.13指向的是源码包解压的路径，而不是安装的路径，否则会报错&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>如果要使用css/js等合并请求加载，请务必安装module --with-http_concat_module，正是我们需要的&lt;/h1>
</span><span class='line'>
</span><span class='line'>make    #挺长一段时间的编译过程
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;p>-e "s|%%PID_PATH%%|/usr/local/nginx/logs/nginx.pid|"
</span><span class='line'>-e "s|%%CONF_PATH%%|/usr/local/nginx/conf/nginx.conf|"
</span><span class='line'>-e "s|%%ERROR_LOG_PATH%%|/usr/local/nginx/logs/error.log|"
</span><span class='line'>make install</span></code></pre></td></tr></table></div></figure></notextile></div></p></blockquote></li>
<li>安装成功
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>success </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/usr/local/nginx/sbin/nginx
</span><span class='line'>chown nobody.nobody -R /usr/local/nginx/html
</span><span class='line'>chmod 700 -R /usr/local/nginx/html</span></code></pre></td></tr></table></div></figure></notextile></div></li>
<li><p>访问http://ip发现成功界面
<img src="http://feeloc.cn/downloads/images/2013-09-04/5.jpg" width="800"></p></li>
<li><p>为了方便管理服务，我们编写一个脚本来启动关闭重启重载配置文件等</p>

<ul>
<li>行关闭服务
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>kill</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /usr/local/nginx/logs/nginx.pid #得到进程ID
</span><span class='line'>kill id</span></code></pre></td></tr></table></div></figure></notextile></div></li>
</ul>


<p>  *写shell脚本，<code>vi /etc/init.d/nginx</code>
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>nginx.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/sh&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;nginx - this script starts and stops the nginx daemin&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;chkconfig:   - 85 15&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;description:  Nginx is an HTTP<span class="o">(</span>S<span class="o">)</span> server, HTTP<span class="o">(</span>S<span class="o">)</span> reverse <span class="se">\&lt;</span>/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;proxy and IMAP/POP3 proxy server&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;processname: nginx&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;config:      /usr/local/nginx/conf/nginx.conf&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;pidfile:     /usr/local/nginx/logs/nginx.pid&lt;/h1&gt;&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Source <span class="k">function </span>library.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;. /etc/rc.d/init.d/functions&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Source networking configuration.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;. /etc/sysconfig/network&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Check that networking is up.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span> <span class="s2">&quot;$NETWORKING&quot;</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span> <span class="o">]</span> &amp;amp;&amp;amp; <span class="nb">exit </span>0&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;nginx<span class="o">=</span><span class="s2">&quot;/usr/local/nginx/sbin/nginx&quot;</span>
</span><span class='line'><span class="nv">prog</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$nginx</span><span class="k">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;NGINX_CONF_FILE<span class="o">=</span><span class="s2">&quot;/usr/local/nginx/conf/nginx.conf&quot;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;lockfile<span class="o">=</span>/var/lock/subsys/nginx&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;start<span class="o">()</span> <span class="o">{</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;<span class="o">[</span> -x <span class="nv">$nginx</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span>5
</span><span class='line'><span class="o">[</span> -f <span class="nv">$NGINX_CONF_FILE</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span>6
</span><span class='line'><span class="nb">echo</span> -n <span class="s2">$&quot;Starting $prog: &quot;</span>
</span><span class='line'>daemon <span class="nv">$nginx</span> -c <span class="nv">$NGINX_CONF_FILE</span>
</span><span class='line'><span class="nv">retval</span><span class="o">=</span><span class="nv">$?</span>
</span><span class='line'><span class="nb">echo</span>
</span><span class='line'><span class="o">[</span> <span class="nv">$retval</span> -eq 0 <span class="o">]</span> &amp;amp;&amp;amp; touch <span class="nv">$lockfile</span>
</span><span class='line'><span class="k">return</span> <span class="nv">$retval</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;stop<span class="o">()</span> <span class="o">{</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;echo -n <span class="s2">$&quot;Stopping $prog: &quot;</span>
</span><span class='line'>killproc <span class="nv">$prog</span> -QUIT
</span><span class='line'><span class="nv">retval</span><span class="o">=</span><span class="nv">$?</span>
</span><span class='line'><span class="nb">echo</span>
</span><span class='line'><span class="o">[</span> <span class="nv">$retval</span> -eq 0 <span class="o">]</span> &amp;amp;&amp;amp; rm -f <span class="nv">$lockfile</span>
</span><span class='line'><span class="k">return</span> <span class="nv">$retval</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;restart<span class="o">()</span> <span class="o">{</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;configtest <span class="o">||</span> <span class="k">return</span> <span class="nv">$?</span>
</span><span class='line'>stop
</span><span class='line'>start
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;reload<span class="o">()</span> <span class="o">{</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;configtest <span class="o">||</span> <span class="k">return</span> <span class="nv">$?</span>
</span><span class='line'><span class="nb">echo</span> -n <span class="s2">$&quot;Reloading $prog: &quot;</span>
</span><span class='line'>killproc <span class="nv">$nginx</span> -HUP
</span><span class='line'><span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
</span><span class='line'><span class="nb">echo</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;force_reload<span class="o">()</span> <span class="o">{</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;restart
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;configtest<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">$nginx</span> -t -c <span class="nv">$NGINX_CONF_FILE</span>
</span><span class='line'><span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;rh_status<span class="o">()</span> <span class="o">{</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;status <span class="nv">$prog</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;rh_status_q<span class="o">()</span> <span class="o">{</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;rh_status &amp;gt;/dev/null 2&amp;gt;&amp;amp;1
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;case <span class="s2">&quot;$1&quot;</span> in&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;start<span class="o">)</span>
</span><span class='line'>    rh_status_q &amp;amp;&amp;amp; <span class="nb">exit </span>0
</span><span class='line'>    <span class="nv">$1</span>
</span><span class='line'>    ;;
</span><span class='line'>stop<span class="o">)</span>
</span><span class='line'>    rh_status_q <span class="o">||</span> <span class="nb">exit </span>0
</span><span class='line'>    <span class="nv">$1</span>
</span><span class='line'>    ;;
</span><span class='line'>restart|configtest<span class="o">)</span>
</span><span class='line'>    <span class="nv">$1</span>
</span><span class='line'>    ;;
</span><span class='line'>reload<span class="o">)</span>
</span><span class='line'>    rh_status_q <span class="o">||</span> <span class="nb">exit </span>7
</span><span class='line'>    <span class="nv">$1</span>
</span><span class='line'>    ;;
</span><span class='line'>force-reload<span class="o">)</span>
</span><span class='line'>    force_reload
</span><span class='line'>    ;;
</span><span class='line'>status<span class="o">)</span>
</span><span class='line'>    rh_status
</span><span class='line'>    ;;
</span><span class='line'>condrestart|try-restart<span class="o">)</span>
</span><span class='line'>    rh_status_q <span class="o">||</span> <span class="nb">exit </span>0
</span><span class='line'>        ;;
</span><span class='line'>*<span class="o">)</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">$&quot;Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>2
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;esac
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<pre><code>*   加权限，开机启动
</code></pre>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>check </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod +x /etc/init.d/nginx
</span><span class='line'>cd /et/init.d/
</span><span class='line'>/sbin/chkconfig nginx on
</span><span class='line'>/sbin/chkconfig --list nginx
</span><span class='line'>nginx           0:off   1:off   2:on    3:on    4:on    5:on    6:off&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>使用以下命令操作nginx&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>service nginx start
</span><span class='line'>service nginx stop
</span><span class='line'>service nginx restart
</span><span class='line'>service nginx reload&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>/etc/init.d/nginx start
</span><span class='line'>/etc/init.d/nginx stop
</span><span class='line'>/etc/init.d/nginx restart
</span><span class='line'>/etc/init.d/nginx reload</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li><p>配置tengine，使之支持静态资源合并访问
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>nginx配置文件 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/local/nginx/conf
</span><span class='line'>vi nginx.conf</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li><p>  1、打开gzip
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>nginx配置文件 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gzip on;
</span><span class='line'>gzip_min_length 1k;
</span><span class='line'>gzip_buffers 16 64k;
</span><span class='line'>gzip_http_version 1.1;
</span><span class='line'>gzip_comp_level 6;
</span><span class='line'>gzip_types text/plain application/x-javascript text/css application/xml;
</span><span class='line'>gzip_vary on</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li><p>  2、新建conf.d/asset.dogolang.com.conf，在nginx.conf 中 include conf.d/*.conf
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>静态文件&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>server {
</span><span class='line'>  listen       80;
</span><span class='line'>  server_name  ***********;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>  #charset koi8-r;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>  #access_log  logs/host.access.log  main;
</span><span class='line'>  location /static/ {&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>      root /***********;
</span><span class='line'>      concat on;
</span><span class='line'>      concat_max_files 20;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>&lt;h1>顺便配置上呆会儿要用的nodejs的访问&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>server {
</span><span class='line'>  listen       80;
</span><span class='line'>  server_name  ***********;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>  #charset koi8-r;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>  #access_log  logs/host.access.log  main;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>  location / {&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>      proxy_pass    http://***********/;
</span><span class='line'>      proxy_redirect          off;
</span><span class='line'>      proxy_set_header Host $host;
</span><span class='line'>      proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li>  执行service nginx reload，更新下配置文件，成功！</li>
</ul>
</li>
</ul>


<h2>二、安装GIT</h2>

<ul>
<li><p>安装git，gitosis
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>git,gitosis安装 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install git python python-setuptools
</span><span class='line'>cd /usr/local/src
</span><span class='line'>git clone git://github.com/res0nat0r/gitosis.git
</span><span class='line'>cd gitosis
</span><span class='line'>python setup.py install</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li><p>在开发机器上生成rsa key，这儿我想用这台服务器做git管理员管理，所以就在这台机器上生成key
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-keygen -t rsa #不需要密码,一路回车就行(在本地操作)
</span><span class='line'>cp /root/.ssh/id_rsa.pub /tmp/id_rsa.pub  # 如果是其它机器就上传下，scp ~/.ssh/id_rsa.pub root@xxx:/tmp/</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li><p>直接用root账号生成git库，网上很多教程使用git账户，因为我对linux权限系统不太了解，最后想写git hooks时，各种命令找不到，各种权限问题，干脆直接用root
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gitosis-init &lt; /tmp/id_rsa.pub&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>Initialized empty Git repository in /root/repositories/gitosis-admin.git/&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>Reinitialized existing Git repository in /root/repositories/gitosis-admin.git/&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li><p>将gitosis-admin库，clone下来，用来管理git库和用户权限，git本来也是采用git来做各种管理的
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /projects
</span><span class='line'>cd /projects
</span><span class='line'>git clone ssh://root@127.0.0.1/gitosis-admin.git
</span><span class='line'>cd gitosis-admin
</span><span class='line'>vi gitosis-admin.conf
</span><span class='line'>[group gitosis-admin]
</span><span class='line'>writable = gitosis-admin
</span><span class='line'>members = root@localhost&lt;/p>&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;h1>这儿的members要和keydir中的&lt;em>.pub中的&lt;/em>号名一致&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>修改后，push&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>git add .
</span><span class='line'>git commit -m "add a user"
</span><span class='line'>git push</span></code></pre></td></tr></table></div></figure></notextile></div>
*   在刚加的git用户的机器上init一个git库，并提交到git仓库中试下
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git init
</span><span class='line'>remote add origin git@YOUR_SERVER_HOSTNAME:PROJECT.git
</span><span class='line'>git add .
</span><span class='line'>git commit -a -m "init project"
</span><span class='line'>git push origin master:refs/heads/master&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>注：修改git项目的地址&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>git remote set-url origin ssh://git@domain.com:3022/~/Projects/p1.git&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>如果希望用代码库中的文件完全覆盖本地工作版本，方法如下：&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>git reset --hard
</span><span class='line'>git pull&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>如果想针对文件回退本地修改，方法如下：&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>git checkout HEAD file/to/restore</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li>我在服务器上git clone一份，刚提交的代码，是一个小项目，呆会儿测试安装nodejs时候使用</li>
</ul>


<h2>三、安装nodejs</h2>

<ul>
<li><p>下载，编译，安装nodejs
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/local/src/
</span><span class='line'>wget http://nodejs.org/dist/v0.10.17/node-v0.10.17.tar.gz
</span><span class='line'>tar zxvf node-v0.10.17.tar.gz
</span><span class='line'>cd node-v0.10.17
</span><span class='line'>./configure --prefix=/usr/local/node/0.10
</span><span class='line'>make   #编译时间很久，或许是我机器不行，基本可以去做100个仰卧起坐
</span><span class='line'>make install&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>将node放入环境变量中&lt;/h1>
</span><span class='line'>
</span><span class='line'>echo "export PATH=$PATH:/usr/local/node/0.10/bin" >> ~/.bash_profile
</span><span class='line'>
</span><span class='line'>&lt;h1>更新环境变量&lt;/h1>
</span><span class='line'>
</span><span class='line'>. ~/.bash_profile
</span><span class='line'>
</span><span class='line'>&lt;h1>echo $PATH 发现node的bin目录已经在环境变量中&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>安装forever模块，启动管理node程序&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>npm install forever -g</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li><p>利用启动脚本，实现自动运行forever的node程序，实现开机自启动，<code>vi /etc/init.d/node</code>
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>node.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;node      Start up node server daemon&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;chkconfig: 345 85 15&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;description: Forever <span class="k">for </span>Node.js&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#
</span><span class='line'><span class="nv">PATH</span><span class="o">=</span>/usr/local/node/0.10/bin
</span><span class='line'><span class="nv">DEAMON</span><span class="o">=</span>/projects/node/app.js
</span><span class='line'><span class="nv">LOG</span><span class="o">=</span>/projects/logs/node/hosts_log
</span><span class='line'><span class="nv">PID</span><span class="o">=</span>/tmp/forever.pid&lt;/p&gt;&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;case <span class="s2">&quot;$1&quot;</span> in&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;start<span class="o">)</span>
</span><span class='line'>    forever start -l <span class="nv">$LOG</span>/forever.log -o <span class="nv">$LOG</span>/forever_out.log -e <span class="nv">$LOG</span>/forever_err.log --pidFile <span class="nv">$PID</span> --minUptime 5000 --spinSleepTime 2000 -a <span class="nv">$DEAMON</span>
</span><span class='line'>    ;;
</span><span class='line'>stop<span class="o">)</span>
</span><span class='line'>    forever stop --pidFile <span class="nv">$PID</span> <span class="nv">$DEAMON</span>
</span><span class='line'>    ;;
</span><span class='line'>stopall<span class="o">)</span>
</span><span class='line'>    forever stopall --pidFile <span class="nv">$PID</span>
</span><span class='line'>    ;;
</span><span class='line'>restartall<span class="o">)</span>
</span><span class='line'>    forever restartall --pidFile <span class="nv">$PID</span>
</span><span class='line'>    ;;
</span><span class='line'>restart<span class="o">)</span>
</span><span class='line'>    forever stop --pidFile <span class="nv">$PID</span> <span class="nv">$DEAMON</span>
</span><span class='line'>    forever start -l <span class="nv">$LOG</span>/forever.log -o <span class="nv">$LOG</span>/forever_out.log -e <span class="nv">$LOG</span>/forever_err.log --pidFile <span class="nv">$PID</span> --minUptime 5000 --spinSleepTime 2000 -a <span class="nv">$DEAMON</span>
</span><span class='line'>    ;;
</span><span class='line'>list<span class="o">)</span>
</span><span class='line'>    forever list
</span><span class='line'>    ;;
</span><span class='line'>*<span class="o">)</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;Usage: /etc.init.d/node {start|stop|restart|reload|stopall|restartall|list}&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'>    ;;
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;esac
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li>开机自动运行
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod 755 /etc/init.d/node
</span><span class='line'>cd /etc/init.d/
</span><span class='line'>chkconfig node on
</span><span class='line'>chkconfig --list node</span></code></pre></td></tr></table></div></figure></notextile></div></li>
</ul>


<h2>四、配置GIT钩子，实现自动部署</h2>

<ul>
<li>需要在客户端push后按照需求更新服务器代码，然后重启服务，所以我们要激活post-receive钩子。<code>vim **/**.git/hooks/post-receive</code>，如果commit -m "[deploy]"，含有[deploy]，就重启该服务
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>post-receive.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&lt;h1&gt;!/bin/sh&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;git autodeploy script when it matches the string <span class="s2">&quot;[deploy]&quot;</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;@author    icyleaf &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#x69;&amp;#108;&amp;#x74;&amp;#x6f;&amp;#x3a;&amp;#x69;&amp;#99;&amp;#x79;&amp;#x6c;&amp;#x65;&amp;#x61;&amp;#x66;&amp;#46;&amp;#x63;&amp;#x6e;&amp;#x40;&amp;#103;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#108;&amp;#46;&amp;#x63;&amp;#111;&amp;#x6d;&quot;</span>&gt;&amp;#105;&amp;#x63;&amp;#x79;&amp;#x6c;&amp;#x65;&amp;#x61;&amp;#102;&amp;#46;&amp;#99;&amp;#x6e;&amp;#x40;&amp;#x67;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#x6c;&amp;#x2e;&amp;#99;&amp;#x6f;&amp;#109;&lt;/a&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;@link      http://icyleaf.com&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;@version   0.1&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Usage:&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;1. put this into the post-receive hook file itself below&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;2. &lt;code&gt;chmod +x post-recive&lt;/code&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;3. Done!&lt;/h1&gt;&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Check the remote git repository whether it is bare&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;IS_BARE<span class="o">=</span><span class="k">$(</span>git rev-parse --is-bare-repository<span class="k">)</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$IS_BARE&quot;</span> <span class="o">]</span>; <span class="k">then</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    <span class="nb">echo</span> &amp;gt;&amp;amp;2 <span class="s2">&quot;fatal: post-receive: IS_NOT_BARE&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;fi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Get the latest commit subject&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;SUBJECT<span class="o">=</span><span class="k">$(</span>git log -1 --pretty<span class="o">=</span>format:<span class="s2">&quot;%s&quot;</span><span class="k">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Deploy the HEAD sources to publish&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;IS_PULL<span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;$SUBJECT&quot;</span> | grep <span class="s2">&quot;[deploy]&quot;</span><span class="k">)</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$IS_PULL&quot;</span> <span class="o">]</span>; <span class="k">then</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    <span class="nb">echo</span> &amp;gt;&amp;amp;2 <span class="s2">&quot;tips: post-receive: IS_NOT_PULL&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;fi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Check the deploy dir whether it exists&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;DEPLOY_DIR<span class="o">=</span>********
</span><span class='line'><span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$DEPLOY_DIR</span> <span class="o">]</span> ; <span class="k">then</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    <span class="nb">echo</span> &amp;gt;&amp;amp;2 <span class="s2">&quot;fatal: post-receive: DEPLOY_DIR_NOT_EXIST: \&quot;$DEPLOY_DIR\&quot;&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;fi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Check the deploy dir whether it is git repository&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;IS_GIT<span class="o">=</span><span class="k">$(</span>git rev-parse --git-dir 2&gt;/dev/null<span class="k">)</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;if <span class="o">[</span> -z <span class="s2">&quot;$IS_GIT&quot;</span> <span class="o">]</span>; <span class="k">then</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;echo &gt;&amp;amp;2 <span class="s2">&quot;fatal: post-receive: IS_NOT_GIT&quot;</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;exit 1&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;fi&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Goto the deploy dir and pull the latest sources&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd <span class="nv">$DEPLOY_DIR</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;env -i git reset --hard&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;env -i git pull&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;restart app.js&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;*** restart     <span class="c">#部署脚本，重启该服务</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>五、mongoDB安装</h2>

<ul>
<li>源码安装及开机启动配置
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1、下载源码，注意64位和32位
</span><span class='line'>cd /usr/local/src/
</span><span class='line'>wget http://fastdl.mongodb.org/linux/mongodb-linux-i686-2.4.6.tgz
</span><span class='line'>2、解压，移动
</span><span class='line'>tar zxvf mongodb-linux-i686-2.4.6.tgz
</span><span class='line'>mv mongodb-linux-i686-2.4.6 /usr/local/mongodb
</span><span class='line'>3、创建数据目录，日志目录
</span><span class='line'>cd /usr/local/mongoDB
</span><span class='line'>mkdir -p ./data/db/
</span><span class='line'>mkdir logs
</span><span class='line'>4、以后台方式运行mongoDB
</span><span class='line'>/usr/local/mongodb/bin/mongod --dbpath=/usr/local/mongodb/data/db --logpath=/usr/local/mongodb/logs/mongodb.log --fork
</span><span class='line'>5、开机启动mongoDB，将启动命令加入rc.local中
</span><span class='line'>echo "/usr/local/mongodb/bin/mongod --dbpath=/usr/local/mongodb/data/db --logpath=/usr/local/mongodb/logs/mongodb.log --fork" >> /etc/rc.local
</span><span class='line'>6、查看mongoDB运行日志
</span><span class='line'>tail -f /usr/local/mongodb/logs/mongodb.log
</span><span class='line'>7、查看mongoDB的运行状态
</span><span class='line'>ps aux |grep mongodb&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p>注：参数解释:
</span><span class='line'>  --dbpath 数据库路径(数据文件)
</span><span class='line'>  --logpath 日志文件路径
</span><span class='line'>  --master 指定为主机器
</span><span class='line'>  --slave 指定为从机器
</span><span class='line'>  --source 指定主机器的IP地址
</span><span class='line'>  --pologSize 指定日志文件大小不超过64M.因为resync是非常操作量大且耗时，最好通过设置一个足够大的oplogSize来避免resync(默认的 oplog大小是空闲磁盘大小的5%)。
</span><span class='line'>  --logappend 日志文件末尾添加
</span><span class='line'>  --port 启用端口号
</span><span class='line'>  --fork 在后台运行
</span><span class='line'>  --only 指定只复制哪一个数据库
</span><span class='line'>  --slavedelay 指从复制检测的时间间隔
</span><span class='line'>  --auth 是否需要验证权限登录(用户名和密码)</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li>编写启动脚本
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>monogo.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;auto start mongodb&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;chkconfig: 345 85 15&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#
</span><span class='line'><span class="nv">mongopath</span><span class="o">=</span>/usr/local/mongodb
</span><span class='line'><span class="nv">dbpath</span><span class="o">=</span>/usr/local/mongodb/data/db
</span><span class='line'><span class="nv">logpath</span><span class="o">=</span>/usr/local/mongodb/logs/mongodb.log
</span><span class='line'><span class="nv">pid</span><span class="o">=</span>/tmp/mongodb.pid
</span><span class='line'><span class="nv">bind_ip</span><span class="o">=</span>0.0.0.0
</span><span class='line'><span class="nv">port</span><span class="o">=</span>27017&lt;/p&gt;&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;case <span class="s2">&quot;$1&quot;</span> in&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;start<span class="o">)</span>
</span><span class='line'>    <span class="nv">$mongopath</span>/bin/mongod --dbpath<span class="o">=</span><span class="nv">$dbpath</span> --logpath<span class="o">=</span><span class="nv">$logpath</span> --bind_ip<span class="o">=</span><span class="nv">$bind_ip</span> --port<span class="o">=</span><span class="nv">$port</span> --auth --pidfilepath<span class="o">=</span><span class="nv">$pid</span> --fork
</span><span class='line'>    ;;
</span><span class='line'>stop<span class="o">)</span>
</span><span class='line'>    <span class="nv">pid</span><span class="o">=</span><span class="sb">`</span>ps -o pid,command ax | grep mongod | awk <span class="s1">&#39;!/awk/ &amp;amp;&amp;amp; !/grep/ {print $1}&#39;</span><span class="sb">`</span>;
</span><span class='line'>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;${pid}&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">        </span><span class="nb">kill</span> -2 <span class="k">${</span><span class="nv">pid</span><span class="k">}</span>;
</span><span class='line'>        <span class="k">fi</span>
</span><span class='line'>    ;;
</span><span class='line'>*<span class="o">)</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;Usage: /etc/init.d/mongodb {start|stop}&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'>    ;;
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;esac
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li><p>开机自动运行
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod 755 /etc/init.d/mongo
</span><span class='line'>cd /etc/init.d/
</span><span class='line'>chkconfig mongo on
</span><span class='line'>chkconfig --list mongo</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li><p>利用脚本更方便管理mongoDB，这样就不用在rc.local中直接写启动脚本了，把<code>/etc/init.d/mongo start</code>，写进去就可以实现开机启动了</p></li>
</ul>


<h2>MySQL安装</h2>

<ul>
<li>安装cmake<code>mysql的编译工具</code>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>下载
</span><span class='line'>wget http://www.cmake.org/files/v2.8/cmake-2.8.12.tar.gz&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p>tar zxvf cmake-2.8.12.tar.gz
</span><span class='line'>cd cmake-2.8.12&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>反正是工具软件，就直接配置编译安装了&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>./configure
</span><span class='line'>make #编译
</span><span class='line'>make install #安装&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>漫长地过程后安装完成&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li>安装MySQL
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>下载适合自己的版本&lt;code>ftp://mirror.switch.ch/mirror/mysql/Downloads/&lt;/code>
</span><span class='line'>wget ftp://mirror.switch.ch/mirror/mysql/Downloads/MySQL-5.6/mysql-5.6.14.tar.gz&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p>groupadd mysql #添加mysql组
</span><span class='line'>useradd -g mysql mysql -s /bin/false #创建用户mysql并加入到mysql组，不允许mysql用户直接登录系统
</span><span class='line'>mkdir -p /data/mysql #创建MySQL数据库存放目录
</span><span class='line'>chown -R mysql:mysql /data/mysql #设置MySQL数据库目录权限
</span><span class='line'>mkdir -p /usr/local/mysql #创建MySQL安装目录
</span><span class='line'>cd /usr/local/src
</span><span class='line'>tar zxvf mysql-5.5.25a.tar.gz #解压
</span><span class='line'>cd mysql-5.5.25a
</span><span class='line'>cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/data/mysql -DSYSCONFDIR=/etc #配置
</span><span class='line'>make #编译
</span><span class='line'>make install #安装&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>cd /usr/local/mysql
</span><span class='line'>cp ./support-files/my-huge.cnf /etc/my.cnf #拷贝配置文件（注意：如果/etc目录下面默认有一个my.cnf，直接覆盖即可）
</span><span class='line'>vi /etc/my.cnf #编辑配置文件,在 [mysqld] 部分增加下面一行
</span><span class='line'>datadir = /data/mysql #添加MySQL数据库路径
</span><span class='line'>:wq! #保存退出
</span><span class='line'>./scripts/mysql_install_db --user=mysql #生成mysql系统数据库
</span><span class='line'>cp ./support-files/mysql.server /etc/rc.d/init.d/mysqld #把Mysql加入系统启动
</span><span class='line'>chmod 755 /etc/init.d/mysqld #增加执行权限
</span><span class='line'>chkconfig mysqld on #加入开机启动
</span><span class='line'>vi /etc/rc.d/init.d/mysqld #编辑
</span><span class='line'>basedir = /usr/local/mysql #MySQL程序安装路径
</span><span class='line'>datadir = /data/mysql #MySQl数据库存放目录
</span><span class='line'>service mysqld start #启动
</span><span class='line'>vi /etc/profile #把mysql服务加入系统环境变量：在最后添加下面这一行
</span><span class='line'>export PATH=$PATH:/usr/local/mysql/bin
</span><span class='line'>:wq! #保存退出
</span><span class='line'>下面这两行把myslq的库文件链接到系统默认的位置，这样你在编译类似PHP等软件时可以不用指定mysql的库文件地址。
</span><span class='line'>ln -s /usr/local/mysql/lib/mysql /usr/lib/mysql
</span><span class='line'>ln -s /usr/local/mysql/include/mysql /usr/include/mysql
</span><span class='line'>shutdown -r now #需要重启系统，等待系统重新启动之后继续在终端命令行下面操作
</span><span class='line'>mysql_secure_installation #设置Mysql密码
</span><span class='line'>根据提示按Y 回车
</span><span class='line'>然后输入2次密码
</span><span class='line'>继续按Y 回车，直到设置完成
</span><span class='line'>或者直接修改密码/usr/local/mysql/bin/mysqladmin -u root -p password "123456" #修改密码
</span><span class='line'>service mysqld restart #重启</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
</feed>
